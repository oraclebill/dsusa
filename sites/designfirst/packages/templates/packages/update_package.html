{% extends "base.html" %}
{# 
  Template Variables Referenced:
    - MEDIA_URL
	- package (package.id, package.attachments)
	- packageform
	- upload_path

  URL definitions referenced:
  	- package-file-upload
	- package-file-delete
#} 

{% block extra-head %}
<link href="{{MEDIA_URL}}js/uploadify/uploadify.css" rel="stylesheet" type="text/css" media="screen" />
<script src="{{MEDIA_URL}}js/uploadify/swfobject.js"></script>
<script src="{{MEDIA_URL}}js/uploadify/jquery.uploadify.js"></script>
<script>
{% url package-file-upload package_id as upload_url %}
$(document).ready(function() {
	// init uploadify widgets
	$('#kitfile').uploadify({
		'uploader'  : '{{MEDIA_URL}}js/uploadify/uploadify.swf',
		'cancelImg' : '{{MEDIA_URL}}js/uploadify/cancel.png',
		'script'    : '{{ upload_url }}',
		'folder'    : '{{ upload_path }}',
		'scriptData': {'filetype': 'kitfile'}, 
		'queueID'	: 'kitqueue',
		'buttonText': 'Update',
		'auto'      : true,
		'multi'     : false,
		'onComplete' : updateFileDisplay('#kitqueue', 0),			
		'onAllComplete' : updateFileDisplay('#kitqueue', 1)			
		});
	$('#quotefile').uploadify({
		'uploader'  : '{{MEDIA_URL}}js/uploadify/uploadify.swf',
		'cancelImg' : '{{MEDIA_URL}}js/uploadify/cancel.png',
		'script'    : '{{ upload_url }}',
		'folder'    : '{{ upload_path }}',
		'scriptData': {'filetype': 'quotefile'}, 
		'buttonText': 'Update',
		'queueID'	: 'quotequeue',
		'auto'      : true,
		'multi'     : false,
		'onComplete' : updateFileDisplay('#quotequeue', 0),			
		'onAllComplete' : updateFileDisplay('#quotequeue', 1)			
		});
	$('#multifile').uploadify({
		'uploader'  : '{{MEDIA_URL}}js/uploadify/uploadify.swf',
		'cancelImg' : '{{MEDIA_URL}}js/uploadify/cancel.png',
		'script'    : '{{ upload_url }}',
		'folder'    : '{{ upload_path }}',
		'scriptData': {'filetype': 'presentation'}, 
		'buttonText': 'Browse',
		'auto'      : true,
		'multi'     : true,
		'onAllComplete' : refreshFileList,
		'onInit': refreshFileList
	});
	// display initial attachment list
	//(onInit) $('#tablecontent').load( '{ url package-files package_id }' )
});

function refreshFileList(event, data) {
//	$('#tablecontent').load( '{{ upload_url }}' )
	return true;
}

</script>
<style type="text/css">
	div#content h4 {
		margin-top: .3em;
		margin-bottom: .15em;
	}
	div#content li span {
		min-width: 10em;
		margin-right: 10em;
		display: inline-block;
	}		
	div#package_data hr {
		margin: 20px 0 0 0;
	}
	dl {
		xfloat: left;
		xborder: solid 1px gray;
		xpadding: 1.2em;
	}
	dl dt {
		float: left;
		clear: left;
		font-weight: bolder;	
		min-width: 9em;
		margin: 0.25em;	
		padding: 0.1em 0.25em;
	}
	dl dd {
		float: left;
		margin: 0.25em;	
		padding: 0.1em 0.25em;
	}
</style>
{% endblock %}

{% block content %} 
<div id="package_data" class="grid_6 ">
	<h4>Order Info</h4>		
	<div class="clearfix">
		<dl>
			<dt>Order ID</dt> <dd>{{ order.id }}</dd>
			<dt>Submitted</dt> <dd>{{ order.submitted|date }}</dd>
			<dt>Rush Processing?</dt> <dd>{{ order.rush }}</dd>
		</dl>
		<hr>
		<dl>
			<dt>Design Level</dt> <dd>{{ order.product_type }}</dd>
			<dt>Project Name</dt> <dd>{{ order.project_name }}</dd>
			<dt>Project Type</dt> <dd>{{ order.get_project_type_display }}</dd>
		</dl>
	</div>
	<h4>Package Info</h4>		
	<div class="clearfix">
		<form action="{% url update-package package.id %}" method="post".>
			<dl>
			    {% for field in form %}
	            <dt>{{ field.label_tag }}</dt><dd>{{ field }} {{ field.errors }}</dd>
			    {% endfor %}
			</dl>
			<input type="submit" name="submit" value="Update Pacakge Info">
		</form>
	</div>
</div>

<div id="package_files" class="grid_10 ">

	<div id="corefiles">
		<h4>Core Files</h4>		
		<ul>
			<li><span>20/20 KIT</span><input type="button" id="kitfile" value="Update"><span id="kitqueue"></span></li>
			<li><span>Price Report</span><input type="button" id="quotefile" value="Update"><span id="quotequeue"></span></li>
		</ul>
	</div>
	
	{% if order.color_views %}
	<h4>Presentation Pack Files</h4>		
	<div id="packfiles">
		<ul>
			{% for packfile in pacakge_files %}
			<li><span><a href="{{ packfile.url }}">{{ packfile }}</span></li>
			{% endfor %}
		</ul>
		<input type="button" id="multifile" value="browse">
		<p id="multifilequeue"></p>
	</div>	
	{% endif %}
	
</div>

{% endblock %}