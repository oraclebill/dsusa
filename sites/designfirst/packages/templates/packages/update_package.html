{% extends "base.html" %}
{# 
  Template Variables Referenced:
    - MEDIA_URL
	- package (package.id, package.attachments)
	- packageform
	- upload_path

  URL definitions referenced:
  	- package-file-upload
	- package-file-delete
#} 

{% block extra-head %}
<link href="{{MEDIA_URL}}js/uploadify/uploadify.css" rel="stylesheet" type="text/css" media="screen" />
<script src="{{MEDIA_URL}}js/uploadify/swfobject.js"></script>
<script src="{{MEDIA_URL}}js/uploadify/jquery.uploadify.js"></script>
<script>
$(document).ready(function() {
	// init uploadify widgets
	$('#multifile').uploadify({
		'uploader'  : '{{MEDIA_URL}}js/uploadify/uploadify.swf',
		'cancelImg' : '{{MEDIA_URL}}js/uploadify/cancel.png',
		'script'    : '{{ upload_files_url }}',
		'folder'    : '{{ upload_path }}',
		'scriptData': {'filetype': 'presentation'}, 
		'buttonText': 'Browse',
		'auto'      : true,
		'multi'     : true,
		'onAllComplete' : refreshFileList,
		'onInit': refreshFileList
	});
	$(':button.delete').live('click', function (event) {
		id = $(this).parent().attr('id').slice(3);
	} );
});


function presentation_line(id, fileobj, filetype, buttonclass) {
	return '<li id="pl_'+id+'">\
				<span class="filetype">' + filetype + '</span> \
				<span class="filename"><a href="' + fileobj.url  + '">' + fileobj.name + '</a></span> \
				<span class="filedate">' + fileobj.formatted_time + '</span> \
				<input type="button" class="' + buttonclass + '" value="'+buttonclass+'"></li>\n';
}

function core_line(id, fileobj, filetype, buttonclass) {
		
	html = '<li ' + (id ? ' id="' + id + 'l">' : '>');
	html += '<span class="filetype">' + (filetype || '') + '</span>';
	html += fileobj ? '<span class="filename"><a href="' + fileobj.url  + '">' + fileobj.name + '</a></span>'
					: '<span class="filename"><a href="#"></a></span>';
	html += '<span class="filedate">' + (fileobj ? fileobj.formatted_time : '') + '</span>';
	html += '<input id="' + id + 'b" type="button" class="' + buttonclass + '" value="'+buttonclass+'">';
	html += '<img id="' + id + 'q">';
	html += '</li>\n';
	
	return html;
}


function refreshFileList(event, data) {
	
	$.getJSON("{{ list_files_url }}", function(data) {
		
		$( '#corefiles' ).empty()
						 .append( core_line( 'kit',   data.kit, 	'20/20 KIT', 'update' ) )
						 .append( core_line( 'quote', data.quote,   'Price Report', 'update' ) );
						 
		$( '#corefiles input' ).uploadify({
			uploader  	: '{{MEDIA_URL}}js/uploadify/uploadify.swf',
			cancelImg 	: '{{MEDIA_URL}}js/uploadify/cancel.png',
			script    	: '{{ upload_files_url }}',
			folder    	: 'core',
//			queueID		: qid,
			auto      	: true,
			buttonText	: 'Update',
			multi     	: false,
			onAllComplete : refreshFileList			
		});
		
		// update view files list 	
		$('#packfiles').empty();
		$.each(data.files, function( idx, item ) { 
			$('#packfiles').append(presentation_line(item.id, item, 'View', 'delete' ));	
		});		
	});
	return true;
}
 
</script>
<style type="text/css">
	div#content h4 {
		margin-top: .3em;
		margin-bottom: .15em;
	}
	
	div#content ul {
		xfont-size: larger;
		list-style: none;
		xmargin-left: .25em;
	}
		
	div#content li {
		margin-left: 0;
	}
		
	div#content li span {
		font-size: larger;
		min-width: 6em;
		margin-right: .5em;
		xmargin-left: .5em;
		display: inline-block;
	}
	
	div#content li span.filetype {
		font-weight: bolder;
		background-color: #efefef;		
	}
	div#content li span.filename {
		width: 240px;
		overflow: hidden;
	}
	
	div#package_data hr {
		margin: 20px 0 0 0;
	}
	
	dl {
		xfloat: left;
		xborder: solid 1px gray;
		xpadding: 1.2em;
	}
	
	dl dt {
		float: left;
		clear: left;
		font-weight: bolder;	
		min-width: 9em;
		margin: 0.25em;	
		padding: 0.1em 0.25em;
	}
	
	dl dd {
		float: left;
		margin: 0.25em;	
		padding: 0.1em 0.25em;
	}
</style>
{% endblock %}

{% block content %} 
<!--
 {{ pacakge }}
 -->
<div id="package_data" class="grid_6 ">
	<h4>Order Info</h4>		
	<div class="clearfix">
		<dl>
			<dt>Order ID</dt> <dd>{{ order.id }}</dd>
			<dt>Submitted</dt> <dd>{{ order.submitted|date }}</dd>
			<dt>Rush Processing?</dt> <dd>{{ order.rush }}</dd>
		</dl>
		<hr>
		<dl>
			<dt>Design Level</dt> <dd>{{ order.product_type }}</dd>
			<dt>Project Name</dt> <dd>{{ order.project_name }}</dd>
			<dt>Project Type</dt> <dd>{{ order.get_project_type_display }}</dd>
		</dl>
	</div>
	<h4>Package Info</h4>		
	<div class="clearfix">
		<form action="{{ update_url }}" method="post".>
			<dl>
			    {% for field in form %}
	            <dt>{{ field.label_tag }}</dt><dd>{{ field }} {{ field.errors }}</dd>
			    {% endfor %}
			</dl>
			<input type="submit" name="submit" value="Update Pacakge Info">
		</form>
	</div>
</div>

<div id="package_files" class="grid_10 ">

	<h4>Core Files</h4>	
	<div>	
		<ul id="corefiles">
			<li id="kitl">
				<span class="filetype">20/20 KIT</span>
				<span class="filename">2020.kit</span>
				<span class="filedate">packfile.date</span>
				<input id="kitbutton" type="button" class="updater" value="update">
				<span id="kitqueue"></span>
				</li>
			<li  id="quotel">
				<span class="filetype">Price Report</span>
				<span class="filename"><a href="#">cabinet_quote.pdf</a></span>
				<span class="filedate">4/17/2010 04:54:16 AM</span>
				<input id="quotebutton" type="button" class="updater" value="update">
				<span id="quotequeue"></span>
				</li>
		</ul>
	</div>
	
	{% if order.color_views %}
	<h4>Presentation Pack Files</h4>		
	<div>
		<ul id="packfiles">
			{% for packfile in package_presentation_files_all %}
			<li><span class="filetype">VIEW</span>
				<span class="filename">view_1.png</span>
				<span class="filedate">54/17/2010 04:54:16 AM</span>
				<input type="button" class="deleter" value="delete"></li>
			{% endfor %}
		</ul>
		<input type="button" id="multifile" value="browse">
		<p id="multifilequeue"></p>
	</div>	
	{% endif %}
	
</div>

<div id="package_files" class="grid_14 prefix_1 ">
	<hr>
	<a href="/dealer/">Back</a>
</div>


{% endblock %}